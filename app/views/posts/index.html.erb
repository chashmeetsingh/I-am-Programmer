<script type="text/javascript">
  function change(userid,postid){
    var butt = document.getElementById("like_button");
    if (butt.value=="Like"){
      $.post("/api/check",
            {
                user_id: userid,
                post_id: postid
            },
            function(data, status){
                if(data==1){
                   butt.value = "Unlike";
                }
                else{
                    $.post("/api/like",
                        {
                            user_id: userid,
                            post_id: postid
                        },
                        function(data, status){
                            butt.value = "Unlike";
                        });   
                }
            });
    }
    else {
      butt.value = "Like";
      $.post("/api/unlike",
          {
              user_id: userid,
              post_id: postid
          },
          function(data, status){
          }); 
    }
  };
</script>

<script>
function checkLike(userid,postid) {
//     var butt = document.getElementById("like_button");
//     alert(JSON.stringify(userid)+" "+postid);
//     if (butt.value=="Like"){
//       $.ajax("/api/check",
//             {
//                 user_id: userid,
//                 post_id: postid
//             },
//             function(data, status){
//                 alert("Data: " + data + "\nStatus: " + status);
//                 if(data==1){
//                   alert('u');
//                    butt.value = "Unlike";
//                 }
//               }
//               )};
// }
//   function new(userid,postid){
//     //var butt = document.getElementById("like_button");
//     alert(JSON.stringify(userid)+" "+postid);
//     if (butt.value=="Like"){
//       $.get("/api/check",
//             {
//                 user_id: userid,
//                 post_id: postid
//             },
//             function(data, status){
//                 alert("Data: " + data + "\nStatus: " + status);
//                 if(data==1){
//                   alert('u');
//                    butt.value = "Unlike";
//                 }
//               }
//               )};
$.ajax({url: "/api/check", 
        type: 'GET',
        data:{
          user_id: userid,
          post_id: postid
        },
        processData: false,
        async: false,
        success: function(result){
         //   alert(result);
         if(data == 0)
          return "Like";
         else 
          return "Unlike";
        },
        error: function(result){
            alert('yo');
        }
  });
}

</script>

<div class="row"> 
    <div class="col-xs-6">
    <% @posts.each do |post| %>
        <div class=" panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title"><%= link_to post.title, post %></h3>
          </div>
          <div class="panel-body">
                <div class="row">
                  <div class="col-xs-6">
                    <a href="<%= post_url(post) %>"><%= image_tag(post.image.profile_size.url) %></a>
                  </div>
                  <div class="col-xs-1"></div>
                  <div class="col-xs-5">  
                    <%= post.hash_tag %><br>  
                    <a href="/profile/<%= post.user.username %>">@<%= post.user.username %></a><br>
                    <% if @like %>
                      <% if @like.post_id=post.id %>
                        <% stat="Unlike" %>
                      <% else %>
                        <% stat="Like" %>
                      <% end %>
                    <% else %>
                      <% stat="Like" %> 
                    <% end %>      
                    <input class="btn btn-default btn-md" onload="load(<%= session[:user_id] %>,<%= post.id %>)" onclick="change(<%= session[:user_id] %>,<%= post.id %>)" type="button" value="<%= stat %>" id="like_button"></input>
                  </div>
                </div>
          </div>
        </div> <% end %>
    </div>
    <div class="col-xs-1"></div>
    <% if !session[:user_id].nil? %>
    <div class="span3 col-xs-5">
     <div class="side-bar"> 
           <div class="ls_profile ls_blue">
               <div> 
               <div class="col-xs-4">
                  <%= image_tag User.find(session[:user_id]).avatar , size: '100x100' %>
                </div>
                <div class="col-xs-8 ls_profile_info">
                    <h3 class="size"><a href="/profile/<%= User.find(session[:user_id]).username %>"><%= User.find(session[:user_id]).username %></a></h3>
                    <p>Total Views : <%= User.find(session[:user_id]).views %></p>
                    
                    Total likes : <%= likes=0 %>
                </div>
           </div>
                <div class="clearfix"></div>
           </div>
       </div>
    </div>
    <% end %>
</div>    
